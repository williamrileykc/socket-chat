var main={opSocket:null,operatorConnected:!1,visitorCount:0,initialize:function(){main.refreshListeners()},refreshListeners:function(){main.removeListeners(),main.addListeners()},testForValidMessage:function(e){return""!=e&&void 0!=e},messages:function(e,t){1==main.testForValidMessage(e)&&$("#messages").append($('<li class="'+t+'">').text(e))}},visitor={Socket:null,activeVisitor:!1,init:function(){visitor.Socket=io(),visitor.Socket.on("connect",function(){}),visitor.Socket.on("message-to-visitor",function(e){main.messages(e,"them")}),visitor.Socket.on("message-to-operator",function(e){main.messages(e,"me")}),visitor.Socket.on("visitor-connected",function(e){visitor.visitorWelcome(e)}),visitor.Socket.on("visitor-active",function(e){visitor.activateCurrentVisitor(e)}),visitor.Socket.on("visitor-queue-update",function(e){visitor.visitorQueueUpdate(e)}),visitor.refreshListeners()},addListeners:function(){$("#editNickname").on("submit",visitor.setNickname),$("#sendMessage").on("submit",visitor.messageToOperator)},removeListeners:function(){$("#editNickname").off("submit",visitor.setNickname),$("#sendMessage").off("submit",visitor.messageToOperator)},refreshListeners:function(){visitor.removeListeners(),visitor.addListeners()},setNickname:function(){var e=$("#nickname").val().trim();return""!=e&&($("#editNickname").addClass("hidden"),$("#sendMessage").removeClass("hidden"),visitor.Socket.emit("visitor-connected",e)),!1},visitorWelcome:function(e){main.visitorCount=e.count,$("#messages").empty(),$("#messages").append($('<li class="visitor-status">')),null!=e.operator&&(main.operatorConnected=!0),visitor.visitorStatusUpdate(main.visitorCount)},visitorQueueUpdate:function(e){visitor.visitorStatusUpdate(e.position)},visitorStatusUpdate:function(e){console.log("number is "+e);var t="";1==main.operatorConnected&&(t="An operator is connected. "),1==e&&$(".visitor-status").text(t+"How can we help you?"),2==e&&$(".visitor-status").text(t+"You are currently next in line"),e>2&&$(".visitor-status").text(t+"You are currently number "+(main.visitorCount-1)+" in line")},activateCurrentVisitor:function(e){visitor.activeVisitor=!0},messageToOperator:function(){return visitor.Socket.emit("message-to-operator",$("#messageField").val()),$("#messageField").val(""),!1}},operator={Socket:null,activeVisitor:null,init:function(){operator.Socket=io(),operator.Socket.on("connect",function(){main.operatorConnected=!0,operator.Socket.emit("operator-connected")}),operator.Socket.on("message-to-visitor",function(e){main.messages(e,"me")}),operator.Socket.on("message-to-operator",function(e){main.messages(e,"them")}),operator.Socket.on("visitor-connected",function(e){operator.visitorConnect(e)}),operator.Socket.on("disconnect",function(e){operator.socketDisconnect(e)}),operator.refreshListeners()},addListeners:function(){$("#editVisitors").on("submit",operator.visitorNickname),$("#sendMessage").on("submit",operator.messageToVisitor)},removeListeners:function(){$("#editVisitors").off("submit",operator.visitorNickname),$("#sendMessage").off("submit",operator.messageToVisitor)},refreshListeners:function(){operator.removeListeners(),operator.addListeners()},visitorConnect:function(e){$("#visitors").append($('<li data-id="'+e.ID+'" data-nickname="'+e.Nickname+'">').text(e.Nickname)),operator.refreshListeners(),operator.updateActiveVisitor()},socketDisconnect:function(e){$("#visitors li").each(function(t,i){$(i).data("id")==e.ID&&$(i).remove(),main.visitorCount=e.count}),operator.updateActiveVisitor()},updateActiveVisitor:function(){$("#visitors li").removeClass("active"),$("#visitors li:first-child").addClass("active"),operator.activeVisitor=$("#visitors li.active").data("id")},visitorSelect:function(){$("#visitors li").removeClass("active"),$(this).addClass("active"),operator.activeVisitor=$(this).data("id")},visitorNickname:function(e){return $("#visitors li.active").text($("#nickname").val()),$("#nickname").val(""),!1},messageToVisitor:function(){var e=$("#messageField").val();return operator.Socket.emit("message-to-visitor",{username:operator.activeVisitor,message:e}),$("#messageField").val(""),!1}};$(document).ready(function(){});